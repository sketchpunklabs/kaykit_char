<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title></title></head>
<style>canvas{ display:block; } body, html { padding:0px; margin:0px; width:100%; height:100%; }</style>
<body><script src="./import-map.js"></script><script type="module">

// #region IMPORTS
import useThreeWebGL2, { THREE, useDarkScene, useVisualDebug } 
                            from './_lib/useThreeWebGL2.js';
import { GLTFLoader }       from './_thirdparty/GLTFLoader.js';
// #endregion

// #region MAIN
let Debug;
let App = useDarkScene( useThreeWebGL2() );
let Ref = {};

// https://www.youtube.com/watch?v=T1KNCtAqJ7A

window.addEventListener( 'load', async ()=>{
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // Setup
    App.sphericalLook( 45, 20, 5, [ 0, 0.9, 0 ] );
    Debug = await useVisualDebug( App );

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    const url  = './_res/models/mannequin/mannequin.gltf';
    const gltf = await GLTFLoaderAsync( url );
    const grp  = gltf.scene;
    App.scene.add( grp );

    // console.log( grp );
    // Object3D    : grp.children[0]
    // SkinnedMesh : grp.children[0].children[0]
    // Bone        : grp.children[0].children[1]

    const url2  = './_res/anim/kaykit_char_animations.gltf';
    const gltf2 = await GLTFLoaderAsync( url2 );
    const ary   = gltf2.animations;
    // console.log( ary );

    Ref.mixer  = new THREE.AnimationMixer( grp.children[0].children[0] );
    Ref.action = Ref.mixer.clipAction( ary[23] );
    Ref.action.play();

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    App.createRenderLoop( onPreRender ).start();
    // App.renderLoop();
});

function onPreRender( dt, et ){
    Ref.mixer.update( dt );
}
// #endregion


/** Wrap ThreeJS's GLTFLoader in a promise to use Async/Await functionality */
function GLTFLoaderAsync( url ){
    return new Promise( ( resolve, reject )=>{
        new GLTFLoader().load( url, resolve, null, reject );
    });
}

</script></body></html>