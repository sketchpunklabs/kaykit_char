/* esm.sh - deepsignal@1.6.0 */
import"./signals.mjs";
import{useMemo as S}from"./hooks.mjs";
import{Signal as P,signal as y,computed as $}from"./signals-core.mjs";
var u=new WeakMap,i=new WeakMap,h=new WeakMap,m=new WeakSet,l=new WeakMap,b=/^\$/,R=Object.getOwnPropertyDescriptor,v=!1,j=function(e){if(!w(e))throw new Error("This object can't be observed.");return i.has(e)||i.set(e,g(e,d)),i.get(e)},K=function(e,t){v=!0;var r=e[t];try{v=!1}catch{}return r};function N(e){return m.add(e),e}var g=function(e,t){var r=new Proxy(e,t);return m.add(r),r},p=function(){throw new Error("Don't mutate the signals directly.")},k=function(e){return function(t,r,n){var c;if(v)return Reflect.get(t,r,n);var o=e||r[0]==="$";if(!e&&o&&Array.isArray(t)){if(r==="$")return h.has(t)||h.set(t,g(t,A)),h.get(t);o=r==="$length"}u.has(n)||u.set(n,new Map);var f=u.get(n),a=o?r.replace(b,""):r;if(f.has(a)||typeof((c=R(t,a))==null?void 0:c.get)!="function"){var s=Reflect.get(t,a,n);if(o&&typeof s=="function")return;if(typeof a=="symbol"&&O.has(a))return s;f.has(a)||(w(s)&&(i.has(s)||i.set(s,g(s,d)),s=i.get(s)),f.set(a,y(s)))}else f.set(a,$(function(){return Reflect.get(t,a,n)}));return o?f.get(a):f.get(a).value}},d={get:k(!1),set:function(e,t,r,n){var c;if(typeof((c=R(e,t))==null?void 0:c.set)=="function")return Reflect.set(e,t,r,n);u.has(n)||u.set(n,new Map);var o=u.get(n);if(t[0]==="$"){r instanceof P||p();var f=t.replace(b,"");return o.set(f,r),Reflect.set(e,f,r.peek(),n)}var a=r;w(r)&&(i.has(r)||i.set(r,g(r,d)),a=i.get(r));var s=!(t in e),M=Reflect.set(e,t,r,n);return o.has(t)?o.get(t).value=a:o.set(t,y(a)),s&&l.has(e)&&l.get(e).value++,Array.isArray(e)&&o.has("length")&&(o.get("length").value=e.length),M},deleteProperty:function(e,t){t[0]==="$"&&p();var r=u.get(i.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),l.has(e)&&l.get(e).value++,n},ownKeys:function(e){return l.has(e)||l.set(e,y(0)),l._=l.get(e).value,Reflect.ownKeys(e)}},A={get:k(!0),set:p,deleteProperty:p},O=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return typeof e=="symbol"})),W=new Set([Object,Array]),w=function(e){return typeof e=="object"&&e!==null&&W.has(e.constructor)&&!m.has(e)},T=function(e){return S(function(){return j(e)},[])};export{j as deepSignal,K as peek,N as shallow,T as useDeepSignal};
//# sourceMappingURL=deepsignal.mjs.map
